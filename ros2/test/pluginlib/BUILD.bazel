load("@rules_cc//cc:defs.bzl", "cc_library", "cc_test")
load("//ros2:plugin.bzl", "ros2_ament_setup", "ros2_plugin")

cc_library(
    name = "polygon_base",
    hdrs = ["regular_polygon.h"],
)

cc_library(
    name = "_polygon_plugins",
    srcs = ["polygon_plugins.cc"],
    deps = [
        ":polygon_base",
        "@ros2_pluginlib//:pluginlib",
    ],
    alwayslink = True,
)

ros2_plugin(
    name = "polygon_plugins",
    base_class_type = "polygon_base::RegularPolygon",
    class_types = [
        "polygon_plugins::Square",
        "polygon_plugins::Triangle",
    ],
    dep = ":_polygon_plugins",
)

ros2_ament_setup(
    name = "ament_setup",
    deps = [":polygon_plugins"],
)

cc_test(
    name = "tests",
    srcs = ["tests.cc"],
    data = [":ament_setup"],
    env = {
        "AMENT_PREFIX_PATH": package_name() + "/ament_setup",
    },
    deps = [
        ":polygon_base",
        "@com_google_googletest//:gtest_main",
        "@ros2_pluginlib//:pluginlib",
    ],
)
